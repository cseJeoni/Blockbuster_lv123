
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>자항선 운항 스케줄 대시보드</title>
  <style>
    :root{
      --cell-w: 40px;
      --cell-h: 28px;
      --hdr-h: 72px;
      --left-w: 120px;
    }
    * { box-sizing: border-box; }
    body{
      margin:0; padding:16px; font-family: 'Malgun Gothic', Arial, sans-serif;
      background:#fafafa; color:#222;
      height:100vh; display:flex; gap:16px;
    }
    #left {
      width: 360px; min-width: 320px; max-width: 420px;
      display:flex; flex-direction:column; gap:12px;
    }
    .card{
      background:#fff; border:1px solid #e5e7eb; border-radius:14px; padding:14px; box-shadow:0 2px 6px rgba(0,0,0,.05);
    }
    .card h2{ margin:0 0 8px 0; font-size:16px; }
    .stats { display: flex; justify-content: space-around; margin: 12px 0; }
    .stat-box { text-align: center; }
    .stat-value { font-size: 20px; font-weight: bold; }
    .stat-label { font-size: 12px; color: #666; }
    #info { font-size:13px; line-height:1.5; white-space:pre-line; }
    #blocksList{ max-height:260px; overflow:auto; border:1px solid #eee; border-radius:10px; padding:8px; font-size:12px; background:#fbfbfb; }
    .muted{ color:#6b7280; }
    .divider{ height:1px; background:#eee; margin:8px 0; }
    #right{
      flex:1; min-width: 400px;
      display:flex; flex-direction:column; gap:12px; overflow:hidden;
    }
    #container{
      position:relative;
      overflow:auto;
      background:#fff;
      border:1px solid #e5e7eb;
      border-radius:14px;
      height: calc(100vh - 140px);
      cursor: grab;
      will-change: scroll-position;
    }
    #container.dragging{ cursor:grabbing; }
    canvas{ display:block; }
    .leftStrip{
      position:absolute; left:0; top:0; width:var(--left-w); height:100%;
      background:linear-gradient(90deg, #fafafa, #fff);
      border-right:1px solid #e5e7eb;
      pointer-events:none;
    }
    #legend{ display:flex; flex-wrap:wrap; gap:6px; }
    #legend .chip{ display:flex; align-items:center; gap:6px; padding:4px 8px; border:1px solid #eee; border-radius:999px; font-size:12px; }
    #legend .sw{ width:14px; height:10px; border-radius:3px; border:1px solid #ddd; }
  </style>
</head>
<body>
  <div id="left">
    <div class="card">
      <h2>운항 통계</h2>
      <div class="stats">
        <div class="stat-box"><div class="stat-value">80</div><div class="stat-label">총 항차 수</div></div>
        <div class="stat-box"><div class="stat-value">354</div><div class="stat-label">총 블록 수</div></div>
        <div class="stat-box"><div class="stat-value">5</div><div class="stat-label">운항 자항선 수</div></div>
      </div>
    </div>

    <div class="card">
      <h2>항차 상세</h2>
      <div id="info" class="muted">차트에서 항차를 클릭하면 상세가 여기에 표시됩니다.</div>
      <div class="divider"></div>
      <div id="blocksList"></div>
    </div>
  </div>

  <div id="right">
    <div id="container">
      <div class="leftStrip"></div>
      <canvas id="gantt"></canvas>
    </div>
    <div id="legend"></div>
  </div>

  <script>
    const DATA = {
      voyage_assignments: {"자항선1_2024-06-01": ["4374_643_000", "4375_665_000", "4375_675_000", "4375_695_000", "4375_685_000", "4385_20G", "4374_20J"], "자항선1_2024-06-13": ["4374_20G", "4374_20L"], "자항선1_2024-06-26": ["4375_245_000", "4375_255_000", "4375_643_000", "4375_646_000", "4375_656_000", "4385_639_000", "4385_629_000", "4387_242_000", "4387_252_000", "4375_677_000", "4375_667_000", "4374_158_000", "4374_148_000", "4375_166_000"], "자항선1_2024-07-09": ["4375_20J", "4375_20G", "4375_20H", "2534_221_000", "4387_664_000", "2534_231_000", "2534_202_000", "2534_224_000"], "자항선1_2024-07-21": ["4387_20H", "4375_20N", "4387_638_000", "4387_628_000", "4376_266_000"], "자항선1_2024-08-10": ["4376_646_000", "4375_148_000", "4375_158_000", "4376_697_000", "4376_687_000", "4376_176_000", "4376_667_000", "4376_677_000", "4376_647_000", "4377_686_000", "4377_696_000", "4376_653_000", "4376_643_000", "4376_652_000", "4376_287_000", "4376_162_000", "4376_172_000"], "자항선1_2024-08-22": ["4376_135_000", "4376_125_000", "3307_24A", "2534_40B", "2534_40D", "4376_20Y", "4377_246_000", "4376_20J"], "자항선1_2024-09-03": ["4376_20H", "4376_20G", "4377_266_000", "4377_276_000", "2550_224_000", "2550_225_000"], "자항선1_2024-09-15": ["4377_643_000", "4377_653_000", "4377_652_000", "4377_642_000", "4377_697_000", "4377_297_000", "4377_687_000", "4377_287_000", "4376_148_000", "4376_158_000", "4377_677_000", "4377_667_000", "4377_657_000", "4377_647_000"], "자항선1_2024-09-27": ["3307_83D", "3307_81D", "4377_162_000", "4377_135_000", "3307_11B", "3307_12B", "4377_163_000", "4377_173_000", "4377_20Y", "4377_20H", "4377_20G"], "자항선1_2024-10-09": ["4377_20N", "4377_20P", "2567_223_000", "2567_233_000", "2567_224_000"], "자항선1_2024-10-23": ["4377_158_000", "2550_66B", "2550_67B", "4388_663_000", "4388_673_000", "4388_126_000", "4388_136_000", "3307_20A", "3307_25A"], "자항선1_2024-11-08": ["4388_283_000", "4389_283_000", "2567_21D", "2567_22D", "4388_683_000", "2535_21D", "2535_22D", "2563_223_000", "2563_221_000", "2563_233_000", "2563_232_000"], "자항선1_2024-11-20": ["2563_222_000", "2563_231_000", "2535_40D", "2563_225_000", "2563_235_000", "4389_664_000", "4389_674_000", "2563_229_000", "2563_239_000", "4388_674_000", "4388_664_000", "4389_663_000", "4389_653_000", "4389_643_000"], "자항선1_2024-12-10": ["4388_20Y", "4390_663_000", "4390_673_000", "4390_643_000", "4390_653_000", "4390_126_000", "4390_136_000"], "자항선1_2024-12-22": ["4388_20F", "4388_20H", "4388_20G", "4388_20L", "4388_20K"], "자항선1_2025-01-09": ["4390_683_000", "4390_693_000", "4389_172_000", "4389_162_000", "4391_663_000", "4391_673_000", "4391_653_000", "4391_643_000", "4390_674_000", "4390_664_000", "4391_136_000", "4391_126_000", "2543_21D", "2543_22D"], "자항선1_2025-01-21": ["4389_20Y", "4389_20G", "4389_20K"], "자항선1_2025-02-04": ["4390_20Y", "4391_693_000", "4392_693_000", "4392_683_000", "4391_683_000", "4389_149_000", "4389_159_000"], "자항선1_2025-02-16": ["4390_20F", "4390_20H", "4390_20G", "4390_20L", "4392_654_000", "4392_644_000", "4391_664_000", "4391_674_000"], "자항선1_2025-03-04": ["4391_20Y", "4391_638_000", "4391_628_000", "4390_159_000", "4391_639_000", "4391_629_000", "4393_653_000", "4393_643_000", "4393_126_000"], "자항선1_2025-03-16": ["4391_20F", "4391_20H", "4391_20G", "4391_20L", "4391_20K"], "자항선1_2025-03-29": ["4393_693_000", "4393_683_000", "4393_654_000", "4393_644_000"], "자항선1_2025-04-10": ["4392_20Y", "4392_638_000", "4392_628_000", "4392_639_000", "4393_628_000"], "자항선1_2025-04-22": ["4393_20Y", "4393_638_000", "4393_639_000", "4393_20F"], "자항선1_2025-05-04": ["4393_20H", "4393_20G", "4393_20L", "4393_20K"], "자항선2_2024-06-05": ["4385_20F"], "자항선2_2024-06-13": ["4386_628_000", "4386_638_000", "4386_629_000"], "자항선2_2024-06-21": ["4387_20D", "4385_171_000"], "자항선2_2024-06-29": ["4375_297_000", "4375_657_000", "4387_683_000", "4387_283_000", "4375_176_000"], "자항선2_2024-07-07": ["4387_693_000", "4387_293_000", "4387_692_000", "4387_674_000", "2534_232_000"], "자항선2_2024-07-15": ["2534_226_000", "4376_686_000", "4376_676_000", "2534_227_000"], "자항선2_2024-07-23": ["4376_276_000", "2534_241_000", "2534_212_000"], "자항선2_2024-08-08": ["4376_656_000", "4376_166_000", "4376_657_000", "4376_642_000", "4377_676_000", "4377_666_000"], "자항선2_2024-08-16": ["4376_163_000", "4376_173_000", "2534_40C"], "자항선2_2024-08-24": ["4377_256_000", "4377_296_000"], "자항선2_2024-09-02": ["4377_286_000", "2550_235_000", "2550_234_000"], "자항선2_2024-09-10": ["2550_223_000", "2550_233_000", "4377_176_000"], "자항선2_2024-09-18": ["3307_82D", "4377_172_000", "4377_125_000"], "자항선2_2024-09-26": ["4377_20L"], "자항선2_2024-10-05": ["3307_13B", "2567_225_000", "2567_234_000"], "자항선2_2024-10-15": ["2567_235_000", "2567_228_000", "2567_238_000"], "자항선2_2024-11-06": ["4389_293_000", "4388_293_000", "4388_693_000", "4389_693_000", "4389_683_000"], "자항선2_2024-11-18": ["4389_673_000"], "자항선2_2024-11-26": ["4389_126_000", "4389_136_000", "4388_162_000", "4388_172_000"], "자항선2_2024-12-26": ["2563_22D", "4390_293_000", "4388_159_000", "4388_149_000"], "자항선2_2025-01-04": ["2563_21D", "4390_283_000"], "자항선2_2025-02-09": ["4392_283_000", "4391_293_000", "4392_293_000", "4391_283_000"], "자항선2_2025-02-18": ["4390_20K", "4392_663_000", "4392_653_000", "4392_643_000", "4392_136_000"], "자항선2_2025-02-26": ["4392_126_000", "4391_162_000", "4391_172_000", "4390_149_000"], "자항선2_2025-03-14": ["4393_213_000", "4393_283_000", "4393_293_000"], "자항선2_2025-03-31": ["4392_629_000"], "자항선3_2024-06-03": ["4374_20N"], "자항선3_2024-06-14": ["4386_639_000", "4375_697_000", "4385_161_000", "4374_172_000", "4374_162_000", "4375_652_000", "4375_642_000"], "자항선3_2024-06-25": ["4375_687_000", "4375_653_000", "4375_285_000", "4375_295_000", "4375_287_000", "4375_647_000"], "자항선3_2024-07-06": ["4375_20K", "4387_682_000", "2534_234_000", "4376_666_000"], "자항선3_2024-07-17": ["4375_171_000", "4375_161_000", "2534_229_000", "4375_162_000", "4375_172_000", "2534_251_000"], "자항선3_2024-07-28": ["4376_286_000", "4376_296_000", "4387_639_000", "4387_629_000"], "자항선3_2024-08-10": ["4376_297_000"], "자항선3_2024-08-24": ["4377_656_000", "4377_646_000", "2534_67B", "2534_66B"], "자항선3_2024-09-04": ["4377_166_000"], "자항선3_2024-09-26": ["4377_20K"], "자항선3_2024-10-07": ["4377_148_000"], "자항선3_2025-01-20": ["4390_162_000", "4390_172_000"], "자항선3_2025-02-12": ["4392_673_000"], "자항선3_2025-03-09": ["4393_136_000"], "자항선3_2025-04-10": ["4392_20G", "4392_20K"], "자항선3_2025-04-21": ["4393_629_000"], "자항선4_2024-06-28": ["2534_222_000"], "자항선4_2024-07-10": ["4387_654_000", "4376_696_000", "2534_236_000", "2534_239_000", "4387_20E"], "자항선4_2024-07-21": ["4387_20F", "4375_20L"], "자항선4_2024-08-23": ["4376_20K", "4376_20L"], "자항선4_2024-09-04": ["4376_20P"], "자항선4_2024-09-26": ["4377_20J"], "자항선4_2025-01-15": ["4389_20F", "4389_20H"], "자항선4_2025-01-26": ["4389_20L"], "자항선4_2025-04-07": ["4392_20F"], "자항선4_2025-04-20": ["4392_20L"], "자항선5_2024-07-01": ["4387_644_000"], "자항선5_2024-07-16": ["2534_281_000", "2534_292_000", "2534_282_000", "2534_291_000"]},
      assignment_info: {"timestamp": "2025-09-11T13:45:57", "elapsed_seconds": 1552.831, "elapsed_hms": "00:25:53", "total_cost_krw": "43,600,000,000 KRW", "schedule_source": "in_memory", "total_blocks": 360, "assigned_blocks": 354, "unassigned_blocks": 6, "assignment_rate": 98.33, "logs": ["[자항선1 2024-05-21_2024-06-01] PATH=COMBINED_OK placed=7", "[자항선1 2024-06-02_2024-06-13] PATH=COMBINED_OK placed=2", "[자항선1 2024-06-15_2024-06-26] PATH=COMBINED_OK placed=14", "[자항선1 2024-06-28_2024-07-09] PATH=COMBINED_OK placed=8", "[자항선1 2024-07-10_2024-07-21] PATH=COMBINED_OK placed=5", "[자항선1 2024-07-30_2024-08-10] PATH=COMBINED_OK placed=17", "[자항선1 2024-08-11_2024-08-22] PATH=COMBINED_OK placed=8", "[자항선1 2024-08-23_2024-09-03] PATH=COMBINED_OK placed=6", "[자항선1 2024-09-04_2024-09-15] SKIP_TOPOFF rate=1.00", "[자항선1 2024-09-04_2024-09-15] PATH=COMBINED_OK placed=14", "[자항선1 2024-09-16_2024-09-27] PATH=COMBINED_OK placed=11", "[자항선1 2024-09-28_2024-10-09] PATH=COMBINED_OK placed=5", "[자항선1 2024-10-12_2024-10-23] SKIP_TOPOFF rate=1.00", "[자항선1 2024-10-12_2024-10-23] PATH=COMBINED_OK placed=9", "[자항선1 2024-10-28_2024-11-08] PATH=COMBINED_OK placed=11", "[자항선1 2024-11-09_2024-11-20] SKIP_TOPOFF rate=0.93", "[자항선1 2024-11-09_2024-11-20] PATH=COMBINED_OK placed=14", "[자항선1 2024-11-29_2024-12-10] PATH=COMBINED_OK placed=7", "[자항선1 2024-12-11_2024-12-22] SKIP_TOPOFF rate=1.00", "[자항선1 2024-12-11_2024-12-22] PATH=COMBINED_OK placed=5", "[자항선1 2024-12-29_2025-01-09] SKIP_TOPOFF rate=1.00", "[자항선1 2024-12-29_2025-01-09] PATH=COMBINED_OK placed=14", "[자항선1 2025-01-10_2025-01-21] PATH=TOPOFF_R1 gain=+2", "[자항선1 2025-01-10_2025-01-21] PATH=FALLBACK_VIP_ONLY_TOPOFF placed=3", "[자항선1 2025-01-24_2025-02-04] PATH=COMBINED_OK placed=7", "[자항선1 2025-02-05_2025-02-16] PATH=TOPOFF_R1 gain=+1", "[자항선1 2025-02-05_2025-02-16] PATH=COMBINED_OK_TOPOFF placed=8", "[자항선1 2025-02-21_2025-03-04] PATH=COMBINED_OK placed=9", "[자항선1 2025-03-05_2025-03-16] PATH=COMBINED_OK placed=5", "[자항선1 2025-03-18_2025-03-29] SKIP_TOPOFF rate=1.00", "[자항선1 2025-03-18_2025-03-29] PATH=COMBINED_OK placed=4", "[자항선1 2025-03-30_2025-04-10] PATH=COMBINED_OK placed=5", "[자항선1 2025-04-11_2025-04-22] PATH=COMBINED_OK placed=4", "[자항선1 2025-04-23_2025-05-04] SKIP_TOPOFF rate=1.00", "[자항선1 2025-04-23_2025-05-04] PATH=COMBINED_OK placed=4", "[자항선2 2024-05-29_2024-06-05] PATH=COMBINED_OK placed=1", "[자항선2 2024-06-06_2024-06-13] PATH=COMBINED_OK placed=3", "[자항선2 2024-06-14_2024-06-21] PATH=COMBINED_OK placed=2", "[자항선2 2024-06-22_2024-06-29] PATH=COMBINED_OK placed=5", "[자항선2 2024-06-30_2024-07-07] PATH=COMBINED_OK placed=5", "[자항선2 2024-07-08_2024-07-15] PATH=COMBINED_OK placed=4", "[자항선2 2024-07-16_2024-07-23] PATH=COMBINED_OK placed=3", "[자항선2 2024-08-01_2024-08-08] SKIP_TOPOFF rate=1.00", "[자항선2 2024-08-01_2024-08-08] PATH=COMBINED_OK placed=6", "[자항선2 2024-08-09_2024-08-16] PATH=COMBINED_OK placed=3", "[자항선2 2024-08-17_2024-08-24] PATH=COMBINED_OK placed=2", "[자항선2 2024-08-26_2024-09-02] PATH=COMBINED_OK placed=3", "[자항선2 2024-09-03_2024-09-10] PATH=COMBINED_OK placed=3", "[자항선2 2024-09-11_2024-09-18] SKIP_TOPOFF rate=1.00", "[자항선2 2024-09-11_2024-09-18] PATH=COMBINED_OK placed=3", "[자항선2 2024-09-19_2024-09-26] PATH=COMBINED_OK placed=1", "[자항선2 2024-09-28_2024-10-05] PATH=COMBINED_OK placed=3", "[자항선2 2024-10-08_2024-10-15] PATH=COMBINED_OK placed=3", "[자항선2 2024-10-30_2024-11-06] SKIP_TOPOFF rate=1.00", "[자항선2 2024-10-30_2024-11-06] PATH=COMBINED_OK placed=5", "[자항선2 2024-11-11_2024-11-18] SKIP_TOPOFF rate=1.00", "[자항선2 2024-11-11_2024-11-18] PATH=COMBINED_OK placed=1", "[자항선2 2024-11-19_2024-11-26] SKIP_TOPOFF rate=1.00", "[자항선2 2024-11-19_2024-11-26] PATH=COMBINED_OK placed=4", "[자항선2 2024-12-19_2024-12-26] PATH=COMBINED_OK placed=4", "[자항선2 2024-12-28_2025-01-04] SKIP_TOPOFF rate=1.00", "[자항선2 2024-12-28_2025-01-04] PATH=COMBINED_OK placed=2", "[자항선2 2025-02-02_2025-02-09] PATH=COMBINED_OK placed=4", "[자항선2 2025-02-11_2025-02-18] PATH=COMBINED_OK placed=5", "[자항선2 2025-02-19_2025-02-26] SKIP_TOPOFF rate=1.00", "[자항선2 2025-02-19_2025-02-26] PATH=COMBINED_OK placed=4", "[자항선2 2025-03-07_2025-03-14] SKIP_TOPOFF rate=1.00", "[자항선2 2025-03-07_2025-03-14] PATH=COMBINED_OK placed=3", "[자항선2 2025-03-24_2025-03-31] SKIP_TOPOFF rate=1.00", "[자항선2 2025-03-24_2025-03-31] PATH=COMBINED_OK placed=1", "[자항선3 2024-05-24_2024-06-03] SKIP_TOPOFF rate=1.00", "[자항선3 2024-05-24_2024-06-03] PATH=COMBINED_OK placed=1", "[자항선3 2024-06-04_2024-06-14] PATH=COMBINED_OK placed=7", "[자항선3 2024-06-15_2024-06-25] SKIP_TOPOFF rate=1.00", "[자항선3 2024-06-15_2024-06-25] PATH=COMBINED_OK placed=6", "[자항선3 2024-06-26_2024-07-06] PATH=COMBINED_OK placed=4", "[자항선3 2024-07-07_2024-07-17] PATH=COMBINED_OK placed=6", "[자항선3 2024-07-18_2024-07-28] PATH=COMBINED_OK placed=4", "[자항선3 2024-07-31_2024-08-10] SKIP_TOPOFF rate=1.00", "[자항선3 2024-07-31_2024-08-10] PATH=COMBINED_OK placed=1", "[자항선3 2024-08-14_2024-08-24] SKIP_TOPOFF rate=1.00", "[자항선3 2024-08-14_2024-08-24] PATH=COMBINED_OK placed=4", "[자항선3 2024-08-25_2024-09-04] SKIP_TOPOFF rate=1.00", "[자항선3 2024-08-25_2024-09-04] PATH=COMBINED_OK placed=1", "[자항선3 2024-09-16_2024-09-26] SKIP_TOPOFF rate=1.00", "[자항선3 2024-09-16_2024-09-26] PATH=COMBINED_OK placed=1", "[자항선3 2024-09-27_2024-10-07] SKIP_TOPOFF rate=1.00", "[자항선3 2024-09-27_2024-10-07] PATH=COMBINED_OK placed=1", "[자항선3 2025-01-10_2025-01-20] SKIP_TOPOFF rate=1.00", "[자항선3 2025-01-10_2025-01-20] PATH=COMBINED_OK placed=2", "[자항선3 2025-02-02_2025-02-12] SKIP_TOPOFF rate=1.00", "[자항선3 2025-02-02_2025-02-12] PATH=COMBINED_OK placed=1", "[자항선3 2025-02-27_2025-03-09] SKIP_TOPOFF rate=1.00", "[자항선3 2025-02-27_2025-03-09] PATH=COMBINED_OK placed=1", "[자항선3 2025-03-31_2025-04-10] PATH=COMBINED_OK placed=2", "[자항선3 2025-04-11_2025-04-21] SKIP_TOPOFF rate=1.00", "[자항선3 2025-04-11_2025-04-21] PATH=COMBINED_OK placed=1", "[자항선4 2024-06-18_2024-06-28] SKIP_TOPOFF rate=1.00", "[자항선4 2024-06-18_2024-06-28] PATH=COMBINED_OK placed=1", "[자항선4 2024-06-30_2024-07-10] PATH=COMBINED_OK placed=5", "[자항선4 2024-07-11_2024-07-21] PATH=COMBINED_OK placed=2", "[자항선4 2024-08-13_2024-08-23] SKIP_TOPOFF rate=1.00", "[자항선4 2024-08-13_2024-08-23] PATH=COMBINED_OK placed=2", "[자항선4 2024-08-25_2024-09-04] PATH=COMBINED_OK placed=1", "[자항선4 2024-09-16_2024-09-26] SKIP_TOPOFF rate=1.00", "[자항선4 2024-09-16_2024-09-26] PATH=COMBINED_OK placed=1", "[자항선4 2025-01-05_2025-01-15] SKIP_TOPOFF rate=1.00", "[자항선4 2025-01-05_2025-01-15] PATH=COMBINED_OK placed=2", "[자항선4 2025-01-16_2025-01-26] SKIP_TOPOFF rate=1.00", "[자항선4 2025-01-16_2025-01-26] PATH=COMBINED_OK placed=1", "[자항선4 2025-03-28_2025-04-07] SKIP_TOPOFF rate=1.00", "[자항선4 2025-03-28_2025-04-07] PATH=COMBINED_OK placed=1", "[자항선4 2025-04-10_2025-04-20] SKIP_TOPOFF rate=1.00", "[자항선4 2025-04-10_2025-04-20] PATH=COMBINED_OK placed=1", "[자항선5 2024-06-21_2024-07-01] SKIP_TOPOFF rate=1.00", "[자항선5 2024-06-21_2024-07-01] PATH=COMBINED_OK placed=1", "[자항선5 2024-07-06_2024-07-16] SKIP_TOPOFF rate=1.00", "[자항선5 2024-07-06_2024-07-16] PATH=COMBINED_OK placed=4"]}
    };
    let voyageBoxes = [];
    let canvas, ctx, container;
    const CELL_W = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--cell-w'));
    const CELL_H = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--cell-h'));
    const HDR_H  = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--hdr-h'));
    const LEFT_W = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--left-w'));

    const vesselOrder = ['자항선1','자항선2','자항선3','자항선4','자항선5'];
    const colors = {
      '자항선1': '#4F46E5',
      '자항선2': '#16A34A',
      '자항선3': '#DC2626',
      '자항선4': '#0891B2',
      '자항선5': '#A855F7'
    };

    function parseDate(str){
      if(/^\d{4}-\d{2}-\d{2}$/.test(str)){
        return new Date(str + 'T00:00:00');
      }
      return new Date(str);
    }
    function formatISO(d){ return d.toISOString().slice(0,10); }
    function daysDiff(a,b){ return Math.round((b - a) / 86400000); }

    function buildVoyageRanges(json){
      const ranges = {};
      const logs = json?.assignment_info?.logs || [];
      const voyageAssignments = json?.voyage_assignments || {};
      
      // 로그에서 날짜 범위 추출
      const logRanges = {};
      const re = /\[(자항선\d) (\d{4}-\d{2}-\d{2})_(\d{4}-\d{2}-\d{2})\]/;
      
      for(const line of logs){
        const m = line.match(re);
        if(!m) continue;
        const vessel = m[1];
        const s = parseDate(m[2]);
        const e = parseDate(m[3]);
        const key = `${vessel}_${formatISO(e)}`;
        logRanges[key] = { start: s, end: e, vessel };
      }
      
      // voyage_assignments의 키들과 로그 범위 매칭
      for(const voyageKey of Object.keys(voyageAssignments)){
        if(logRanges[voyageKey]){
          ranges[voyageKey] = logRanges[voyageKey];
        } else {
          // 로그에서 찾을 수 없으면 키에서 날짜 추출해서 추정
          const parts = voyageKey.split('_');
          if(parts.length >= 2){
            const vessel = parts[0];
            const endDate = parseDate(parts[1]);
            // 12일 항차로 가정 (기본값)
            const startDate = new Date(endDate);
            startDate.setDate(startDate.getDate() - 11);
            ranges[voyageKey] = { start: startDate, end: endDate, vessel };
          }
        }
      }
      
      console.log('Total ranges built:', Object.keys(ranges).length);
      console.log('Sample ranges:', Object.keys(ranges).slice(0, 5));
      return ranges;
    }

    function drawChart(){
      const gantt = document.getElementById('gantt');
      canvas = gantt; ctx = gantt.getContext('2d'); container = document.getElementById('container');

      const ranges = buildVoyageRanges(DATA);
      const all = Object.values(ranges);
      if(all.length === 0) return;
      
      const minStart = new Date(Math.min(...all.map(r => r.start.getTime())));
      const maxEnd   = new Date(Math.max(...all.map(r => r.end.getTime())));

      const chartStart = new Date(minStart); chartStart.setDate(chartStart.getDate()-3);
      const chartEnd   = new Date(maxEnd);   chartEnd.setDate(chartEnd.getDate()+3);
      const totalDays  = daysDiff(chartStart, chartEnd) + 1;

      const rows = vesselOrder.length;
      canvas.width  = LEFT_W + totalDays * CELL_W + 2;
      canvas.height = HDR_H + rows * CELL_H + 1;

      ctx.fillStyle = '#fff'; ctx.fillRect(0,0,canvas.width,canvas.height);

      drawHeader(chartStart, totalDays);

      ctx.font = '12px Arial'; ctx.textBaseline = 'middle'; ctx.fillStyle = '#111827';
      voyageBoxes = [];
      vesselOrder.forEach((vessel, idx) => {
        const y = HDR_H + idx * CELL_H;
        ctx.strokeStyle = '#e5e7eb';
        ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(canvas.width, y); ctx.stroke();
        ctx.fillText(vessel, 10, y + CELL_H/2);
      });
      
      ctx.strokeStyle = '#e5e7eb'; ctx.beginPath();
      ctx.moveTo(0, HDR_H + rows*CELL_H); ctx.lineTo(canvas.width, HDR_H + rows*CELL_H); ctx.stroke();

      const perVessel = DATA?.voyage_assignments || {};
      const voyagesByVessel = {};
      Object.keys(perVessel).forEach(vid => {
        const vessel = vid.split('_')[0];
        if (!voyagesByVessel[vessel]) voyagesByVessel[vessel] = [];
        voyagesByVessel[vessel].push(vid);
      });

      vesselOrder.forEach((vessel, idx) => {
        const list = voyagesByVessel[vessel] || [];
        const yTop = HDR_H + idx * CELL_H + 2;
        for(const vid of list){
          const r = ranges[vid];
          if(!r) continue;
          const x = LEFT_W + daysDiff(chartStart, r.start) * CELL_W;
          const w = (daysDiff(r.start, r.end)+1) * CELL_W;

          ctx.fillStyle = colors[vessel] || '#888';
          ctx.fillRect(x+1, yTop, w-2, CELL_H-4);
          ctx.strokeStyle = '#111827'; ctx.strokeRect(x+0.5, yTop-0.5, w-1, CELL_H-3);

          const blocks = (DATA.voyage_assignments || {})[vid] || [];
          const label = `${blocks.length}개`;
          ctx.fillStyle = '#fff'; ctx.font = 'bold 12px Arial';
          const tw = ctx.measureText(label).width;
          if(tw < w - 8){
            ctx.fillText(label, x + (w - tw)/2, yTop + (CELL_H-4)/2 + 1);
          }

          voyageBoxes.push({ x:x+1, y:yTop, w:w-2, h:CELL_H-4, vessel, vid, start:r.start, end:r.end, blocks });
        }
      });

      const leg = document.getElementById('legend');
      leg.innerHTML = '';
      vesselOrder.forEach(v => {
        const chip = document.createElement('div');
        chip.className = 'chip';
        const sw = document.createElement('div'); sw.className='sw'; sw.style.background = colors[v] || '#888';
        chip.appendChild(sw); chip.append(v);
        leg.appendChild(chip);
      });

      container.scrollLeft = 0;
    }

    function drawHeader(chartStart, totalDays){
      const dTmp = new Date(chartStart);
      const canvasW = LEFT_W + totalDays*CELL_W;
      const canvasH = HDR_H;

      const c = ctx;
      c.fillStyle = '#fafafa'; c.fillRect(0, 0, canvasW, canvasH);
      c.strokeStyle = '#e5e7eb'; c.beginPath(); c.moveTo(0, HDR_H); c.lineTo(canvasW, HDR_H); c.stroke();

      for(let i=0;i<=totalDays;i++){
        const x = LEFT_W + i * CELL_W;
        c.strokeStyle = '#f1f5f9';
        c.beginPath(); c.moveTo(x, 0); c.lineTo(x, canvas.height); c.stroke();
      }

      c.fillStyle = '#fff'; c.fillRect(0,0,LEFT_W,canvasH);
      c.strokeStyle = '#e5e7eb'; c.beginPath(); c.moveTo(LEFT_W,0); c.lineTo(LEFT_W,canvasH); c.stroke();

      c.textBaseline = 'alphabetic';
      let lastYear = -1, lastMonth = -1;
      for(let i=0;i<totalDays;i++){
        const x = LEFT_W + i * CELL_W;
        const year = dTmp.getFullYear();
        const month = dTmp.getMonth()+1;
        const day = dTmp.getDate();

        if(year !== lastYear){
          c.fillStyle = '#111827'; c.font = 'bold 14px Arial';
          c.fillText(`${year}년`, x + 6, 20);
          lastYear = year;
          lastMonth = -1;
        }
        if(month !== lastMonth){
          c.fillStyle = '#374151'; c.font = 'bold 12px Arial';
          c.fillText(`${month}월`, x + 6, 40);
          lastMonth = month;
        }
        const dd = day.toString().padStart(2,'0');
        c.fillStyle = '#6b7280'; c.font = '12px Arial';
        const cx = x + CELL_W/2 - 4;
        c.fillText(dd[0], cx, 56);
        c.fillText(dd[1], cx, 68);

        dTmp.setDate(dTmp.getDate()+1);
      }
    }

    function showDetail(box){
      const info = document.getElementById('info');
      const list = document.getElementById('blocksList');
      const start = box.start.toISOString().slice(0,10);
      const end   = box.end.toISOString().slice(0,10);
      info.classList.remove('muted');
      info.innerHTML =
        `• 항차: ${box.vid}
`+
        `• 기간: ${start} ~ ${end}
`+
        `• 실린 블록 개수: ${box.blocks.length.toLocaleString()}개`;

      if(!box.blocks.length){ list.innerHTML = '<span class="muted">배정된 블록 없음</span>'; return; }
      const frag = document.createDocumentFragment();
      const ul = document.createElement('div');
      for(const bid of box.blocks){
        const row = document.createElement('div');
        row.textContent = `${bid}`;
        ul.appendChild(row);
      }
      list.innerHTML = ''; list.appendChild(ul);
    }

    function hitTest(px, py){
      for(let i=0;i<voyageBoxes.length;i++){
        const b = voyageBoxes[i];
        if(px>=b.x && px<=b.x+b.w && py>=b.y && py<=b.y+b.h) return b;
      }
      return null;
    }

    (function setupInteractions(){
      const cont = document.getElementById('container');
      let isDown=false, sx=0, sl=0;
      cont.addEventListener('mousedown', (e)=>{
        isDown=true; sx=e.clientX; sl=cont.scrollLeft; cont.classList.add('dragging');
      });
      cont.addEventListener('mouseleave', ()=>{ isDown=false; cont.classList.remove('dragging'); });
      cont.addEventListener('mouseup', ()=>{ isDown=false; cont.classList.remove('dragging'); });
      cont.addEventListener('mousemove', (e)=>{
        if(!isDown) return;
        const dx = e.clientX - sx;
        cont.scrollLeft = sl - dx;
      });
      cont.addEventListener('wheel', (e)=>{
        if(e.ctrlKey) e.preventDefault();
      }, {passive:false});

      cont.addEventListener('click', (e)=>{
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left + cont.scrollLeft;
        const y = e.clientY - rect.top + cont.scrollTop;
        const box = hitTest(x,y);
        if(box) showDetail(box);
      });
    })();

    drawChart();

    window.addEventListener('resize', ()=>{
      drawChart();
    });
  </script>
</body>
</html>